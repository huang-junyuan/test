



# 第一周



## Requests库入门



### 安装

打开命令行，输入`pip install requests`即可安装

![image-20210829120332023](爬虫1.assets/image-20210829120332023.png)

### 测试

`r.status_code`状态码是200表示访问成功

`r.encoding = 'utf-8'`更改它的编码为UTF-8编码

`r.text`打印网页内容

![image-20210829120810343](爬虫1.assets/image-20210829120810343.png)

### 主要方法

| 方法                | 说明                                           |
| ------------------- | ---------------------------------------------- |
| requests.requests() | 构造一个请求，支撑以下各方法的基础方法         |
| requests.get()      | 获取HTML网页的主要方法，对应于HTTP的GET        |
| requests.head()     | 获取HTML网页头信息的方法，对应于HTTP的HEAD     |
| requests.post()     | 向HTML网页提交POST请求的方法，对应于HTTP的POST |
| requests.put()      | 向HTML网页提交PUT请求的方法，对应于HTTP的PUT   |
| requests.patch()    | 向HTML网页提交局部修改请求，对应于HTTP的PATCH  |
| requests.delete()   | 向HTML页面提交删除请求，对应于HTTP的DELETE     |

### get方法

这个对象是Requests库内部生成的，

![image-20210829121635191](爬虫1.assets/image-20210829121635191.png)

![image-20210829121715457](爬虫1.assets/image-20210829121715457.png)

![image-20210829121747326](爬虫1.assets/image-20210829121747326.png)

![image-20210829121909856](爬虫1.assets/image-20210829121909856.png)

Response对象包含服务器返回的所有信息，同时也包含了我们去向服务器请求的request信息

![image-20210829122128044](爬虫1.assets/image-20210829122128044.png)

我们从一个url链接上获得一个图片，这个图片里边的资源是以二进制形式存储的，那就可以通过r.content来还原这个图片



流程

![image-20210829122432899](爬虫1.assets/image-20210829122432899.png)

![image-20210829122625458](爬虫1.assets/image-20210829122625458.png)

![image-20210829122718874](爬虫1.assets/image-20210829122718874.png)

### 爬取网页的通用代码框架

![image-20210829122900114](爬虫1.assets/image-20210829122900114.png)



Response对象的属性

![image-20210829123114000](爬虫1.assets/image-20210829123114000.png)

![image-20210829123309534](爬虫1.assets/image-20210829123309534.png)

![image-20210829123407483](爬虫1.assets/image-20210829123407483.png)



### HTTP协议及Requests库方法

![image-20210829123719367](爬虫1.assets/image-20210829123719367.png)

请求与响应的模式：用户发起请求，服务器做出相关响应

无状态：第一次请求与第二次请求之间并没有相关的关联

应用层协议指该协议工作在TCP协议之上

![image-20210829123932455](爬虫1.assets/image-20210829123932455.png)

![image-20210829124016081](爬虫1.assets/image-20210829124016081.png)

![image-20210829124100811](爬虫1.assets/image-20210829124100811.png)

![image-20210829124142400](爬虫1.assets/image-20210829124142400.png)

![image-20210829135214687](爬虫1.assets/image-20210829135214687.png)

![image-20210829135400324](爬虫1.assets/image-20210829135400324.png)

![image-20210829135420699](爬虫1.assets/image-20210829135420699.png)

![image-20210829135525655](爬虫1.assets/image-20210829135525655.png)

![image-20210829135645452](爬虫1.assets/image-20210829135645452.png)

当我们向url，post一个字典或者键值对的时候，那么键值对默认存储到表单的字段下

![image-20210829140429808](爬虫1.assets/image-20210829140429808.png)

![image-20210829140518994](爬虫1.assets/image-20210829140518994.png)



### Requests库主要方法解析

![image-20210829140640957](爬虫1.assets/image-20210829140640957.png)

![image-20210829140709431](爬虫1.assets/image-20210829140709431.png)

![image-20210829140835322](爬虫1.assets/image-20210829140835322.png)

![image-20210829141044183](爬虫1.assets/image-20210829141044183.png)

![image-20210829141128806](爬虫1.assets/image-20210829141128806.png)

![image-20210829141233070](爬虫1.assets/image-20210829141233070.png)

![image-20210829141318546](爬虫1.assets/image-20210829141318546.png)

![image-20210829141345273](爬虫1.assets/image-20210829141345273.png)

![image-20210829141424482](爬虫1.assets/image-20210829141424482.png)

![image-20210829141502907](爬虫1.assets/image-20210829141502907.png)

![image-20210829141547758](爬虫1.assets/image-20210829141547758.png)

![image-20210829141710548](爬虫1.assets/image-20210829141710548.png)

![image-20210829141757589](爬虫1.assets/image-20210829141757589.png)

![image-20210829141815652](爬虫1.assets/image-20210829141815652.png)

![image-20210829141841353](爬虫1.assets/image-20210829141841353.png)

![image-20210829141856029](爬虫1.assets/image-20210829141856029.png)

![image-20210829141909800](爬虫1.assets/image-20210829141909800.png)

## 网络爬虫的“盗亦有道”

### 网络爬虫引发的问题

![image-20210829142234377](爬虫1.assets/image-20210829142234377.png)

![image-20210829142330876](爬虫1.assets/image-20210829142330876.png)

![image-20210829142603409](爬虫1.assets/image-20210829142603409.png)





### Robots协议



![image-20210829142947877](爬虫1.assets/image-20210829142947877.png)



![image-20210829143456220](爬虫1.assets/image-20210829143456220.png)

### Robots协议的遵守方式

![image-20210829143719275](爬虫1.assets/image-20210829143719275.png)

## Requests库网络爬虫实战

通过`r.request.headers`查看发给网站的request信息的头部是什么内容



![image-20210829145454151](爬虫1.assets/image-20210829145454151.png)

 ![image-20210829150139200](爬虫1.assets/image-20210829150139200.png)

### 百度360搜索关键词提交

![image-20210829145854165](爬虫1.assets/image-20210829145854165.png)

![image-20210829150010656](爬虫1.assets/image-20210829150010656.png)

![image-20210829150057144](爬虫1.assets/image-20210829150057144.png)

![image-20210829150118227](爬虫1.assets/image-20210829150118227.png)

### 网络图片的爬取和存储

![image-20210829150237169](爬虫1.assets/image-20210829150237169.png)

图片是以`.jpg`结尾的，那说明它就是一个图片链接，而且它是一个文件，



以二进制形式打开了一个文件，这个文件就是我们要存储的abc.jpg，并且把它定义为一个文件标识符f，然后将返回的内容写到这个文件中，r.content表示返回内容的二进制，最后将文件关闭

![image-20210829150758679](爬虫1.assets/image-20210829150758679.png)

![image-20210829150813823](爬虫1.assets/image-20210829150813823.png)

### IP地址归属地的自动查询



# 网络爬虫之提取

## BeautifulSoup库入门

### 安装

该库能够对html、xml格式进行解析，并且提取其中的相关信息

打开控制台，输入`pip install beautifulsoup4` 

![image-20210829193721945](爬虫1.assets/image-20210829193721945.png)

从bs4库导入了一个类叫做BeautifulSoup

给出一个解析demo的解释器，这里解释器使用的是html.parser，也就是对demo进行html的解析

![image-20210829194607874](爬虫1.assets/image-20210829194607874.png)

 

![image-20210829194618423](爬虫1.assets/image-20210829194618423.png)





###BeautifulSoup库的基本元素

![image-20210829194809523](爬虫1.assets/image-20210829194809523.png)

![image-20210829194920810](爬虫1.assets/image-20210829194920810.png)

![image-20210829195007306](爬虫1.assets/image-20210829195007306.png)

![image-20210829195154218](爬虫1.assets/image-20210829195154218.png)

![image-20210829195216462](爬虫1.assets/image-20210829195216462.png)

![image-20210829195313975](爬虫1.assets/image-20210829195313975.png) 



任何存在于html语法的标签都可以使用`html.tag`的方式打印出来，当文档存在多个相同标签时，返回的是第一个

![image-20210829201204410](爬虫1.assets/image-20210829201204410.png)





![image-20210829201534657](爬虫1.assets/image-20210829201534657.png)

可以跨越标签



```html
<b><!--This is a comment--></b><p>This is not a comment</p>
```

![image-20210829202232923](爬虫1.assets/image-20210829202232923.png)





### 基于bs4库的HTML内容遍历方法

![image-20210829202415887](爬虫1.assets/image-20210829202415887.png)

![image-20210829202449646](爬虫1.assets/image-20210829202449646.png)

![image-20210829202513442](爬虫1.assets/image-20210829202513442.png)

![image-20210829202555966](爬虫1.assets/image-20210829202555966.png)



![image-20210829202657267](爬虫1.assets/image-20210829202657267.png)

![image-20210829210257055](爬虫1.assets/image-20210829210257055.png)

![image-20210829210327289](爬虫1.assets/image-20210829210327289.png)

迭代类型只能用在for循环中

![image-20210829210350094](爬虫1.assets/image-20210829210350094.png)





html是最高级标签，它的父亲就是自己

![image-20210829210617050](爬虫1.assets/image-20210829210617050.png)

soup标签没有父亲



![image-20210829210709953](爬虫1.assets/image-20210829210709953.png)



![image-20210829211000219](爬虫1.assets/image-20210829211000219.png)

![image-20210829211115320](爬虫1.assets/image-20210829211115320.png)



在标签树中，标签之间的NavigableString也构成了标签树的结点

![image-20210829211617686](爬虫1.assets/image-20210829211617686.png)



![image-20210829211644213](爬虫1.assets/image-20210829211644213.png)



![image-20210829211830755](爬虫1.assets/image-20210829211830755.png)







### 基于bs4库的HTML格式输出



![image-20210829211940122](爬虫1.assets/image-20210829211940122.png)

![image-20210829212145263](爬虫1.assets/image-20210829212145263.png)

prettify能够为html文本的标签以及内容增加换行符，也可以对每一个标签来做相关的处理

![image-20210829212334672](爬虫1.assets/image-20210829212334672.png)



bs4库将任何读入的html文件或字符串都转换成了utf-8编码，





## 信息组织与提取



### 信息标记的三种形式



![image-20210829212838285](爬虫1.assets/image-20210829212838285.png)





![image-20210829213045433](爬虫1.assets/image-20210829213045433.png)



![image-20210829213130075](爬虫1.assets/image-20210829213130075.png)



国际公认的信息标记种类，有三种形式，分别是XML、JSON和YAML

![image-20210829213317231](爬虫1.assets/image-20210829213317231.png)



标签中没有内容

![image-20210829213427088](爬虫1.assets/image-20210829213427088.png)

![image-20210829213451009](爬虫1.assets/image-20210829213451009.png)

![image-20210829213535199](爬虫1.assets/image-20210829213535199.png)





![image-20210829213646531](爬虫1.assets/image-20210829213646531.png)

键和值都要加双引号来表达它是字符串的形式，如果值是数字，则可以直接写



有多个值时

![image-20210829213900087](爬虫1.assets/image-20210829213900087.png)



键值对之间可以嵌套使用，

![image-20210829213947798](爬虫1.assets/image-20210829213947798.png)



![image-20210829214020390](爬虫1.assets/image-20210829214020390.png)



![image-20210829214117546](爬虫1.assets/image-20210829214117546.png)

键和值都没有双引号的形式

通过缩进的方式来表示所属关系

![image-20210829214214756](爬虫1.assets/image-20210829214214756.png)



YAML用减号表达并列关系

![image-20210829214316838](爬虫1.assets/image-20210829214316838.png)



![image-20210829214404551](爬虫1.assets/image-20210829214404551.png)

![image-20210829214421096](爬虫1.assets/image-20210829214421096.png)



### 三种信息标记形式的比较

![image-20210829214552737](爬虫1.assets/image-20210829214552737.png)

![image-20210829214636194](爬虫1.assets/image-20210829214636194.png)

![image-20210829214714116](爬虫1.assets/image-20210829214714116.png)



![image-20210829221427405](爬虫1.assets/image-20210829221427405.png)

 



JSON格式是用在程序对接口处理的地方，JSON数据在经过传输之后能够作为程序代码一部分并被程序直接运行，这样JSON格式中对信息类型的定义才能最大的发挥作用。缺陷是无法体现注释



![image-20210829221728526](爬虫1.assets/image-20210829221728526.png)



### 信息提取的一般方法

信息标记中包含标记和信息两部分



![image-20210829221940821](爬虫1.assets/image-20210829221940821.png)



![image-20210829222034497](爬虫1.assets/image-20210829222034497.png)



![image-20210829222119456](爬虫1.assets/image-20210829222119456.png)

 

![image-20210829222308239](爬虫1.assets/image-20210829222308239.png)



![image-20210829222452076](爬虫1.assets/image-20210829222452076.png)



### 基于bs4库的HTML内容查找方法

![image-20210829222547718](爬虫1.assets/image-20210829222547718.png)

![image-20210829222643320](爬虫1.assets/image-20210829222643320.png)



同时查找a标签和b标签，这时两者以列表形式给第一个参数

![image-20210829223020999](爬虫1.assets/image-20210829223020999.png)



如果给出的标签名称是True，将显示当前soup的所有标签信息

![image-20210829223209200](爬虫1.assets/image-20210829223209200.png)



![image-20210829223436706](爬虫1.assets/image-20210829223436706.png)



![image-20210829223518691](爬虫1.assets/image-20210829223518691.png)

可以检索某一个标签对应的属性中是否包含了某些字符信息



![image-20210829223715843](爬虫1.assets/image-20210829223715843.png)



属性赋值查找，例如查找id属性等于link1的值

![image-20210829223904835](爬虫1.assets/image-20210829223904835.png)





![image-20210829224147676](爬虫1.assets/image-20210829224147676.png)

默认情况搜索的是从某一个标签开始的后续所有子孙结点的信息，如果我们只想搜索当前结点儿子这一层面的结点信息，我们可以将recursive置为False

从soup的根结点开始，它的儿子结点层面上是没有a标签的

![image-20210829224610929](爬虫1.assets/image-20210829224610929.png)





![image-20210829224642324](爬虫1.assets/image-20210829224642324.png)

![image-20210829224756212](爬虫1.assets/image-20210829224756212.png)





![image-20210829224848597](爬虫1.assets/image-20210829224848597.png)

![image-20210829224914825](爬虫1.assets/image-20210829224914825.png)



## 中国大学排名的爬虫

![image-20210829225506960](爬虫1.assets/image-20210829225506960.png)



# 实战



## Re（正则表达式）库入门



### 概念



![image-20210829225930030](爬虫1.assets/image-20210829225930030.png)

正则表达式表示了一组字符串的特征或模式



![image-20210829230108243](爬虫1.assets/image-20210829230108243.png)





![image-20210829230213607](爬虫1.assets/image-20210829230213607.png)





![image-20210829230308215](爬虫1.assets/image-20210829230308215.png)

![image-20210829230408548](爬虫1.assets/image-20210829230408548.png)



![image-20210830070448140](爬虫1.assets/image-20210830070448140.png)





### 语法

![image-20210830070557905](爬虫1.assets/image-20210830070557905.png)

![image-20210830070633906](爬虫1.assets/image-20210830070633906.png)

![image-20210830070828338](爬虫1.assets/image-20210830070828338.png)

{m, n}中的m不写是默认为0



![image-20210830071550900](爬虫1.assets/image-20210830071550900.png)



![image-20210830071730403](爬虫1.assets/image-20210830071730403.png)



![image-20210830071945261](爬虫1.assets/image-20210830071945261.png)



### Re库的基本使用



![image-20210830072128042](爬虫1.assets/image-20210830072128042.png)



只要安装了python的解释器，就可以使用标准库而不用额外安装



![image-20210830072236537](爬虫1.assets/image-20210830072236537.png)



原生字符串中的斜杠`\`不被解释为转义符



![image-20210830072416260](爬虫1.assets/image-20210830072416260.png)



![image-20210830072453359](爬虫1.assets/image-20210830072453359.png)



![image-20210830072635536](爬虫1.assets/image-20210830072635536.png)



![image-20210830072707389](爬虫1.assets/image-20210830072707389.png)



![image-20210830073056691](爬虫1.assets/image-20210830073056691.png)





![image-20210830073141452](爬虫1.assets/image-20210830073141452.png)



![image-20210830073508282](爬虫1.assets/image-20210830073508282.png)



在使用时一定要判断match是不是空的



![image-20210830073713314](爬虫1.assets/image-20210830073713314.png)





![image-20210830073737841](爬虫1.assets/image-20210830073737841.png)



![image-20210830073923264](爬虫1.assets/image-20210830073923264.png)





![image-20210830074011524](爬虫1.assets/image-20210830074011524.png)

匹配的部分去掉，去掉之后的部分分别作为分割的字符串元素放到一个列表里



![image-20210830074458046](爬虫1.assets/image-20210830074458046.png)



![image-20210830074530456](爬虫1.assets/image-20210830074530456.png)



![image-20210830074744010](爬虫1.assets/image-20210830074744010.png)



![image-20210830074850267](爬虫1.assets/image-20210830074850267.png)



![image-20210830075242713](爬虫1.assets/image-20210830075242713.png)



![image-20210830075447557](爬虫1.assets/image-20210830075447557.png)



![image-20210830075609063](爬虫1.assets/image-20210830075609063.png)

regex才是正则表达式，代表了一组字符串



![image-20210830075714501](爬虫1.assets/image-20210830075714501.png)



传入参数只是需要匹配的字符串





### Re库的Match对象

![image-20210830075937287](爬虫1.assets/image-20210830075937287.png)



![image-20210830080028665](爬虫1.assets/image-20210830080028665.png)



![image-20210830090648696](爬虫1.assets/image-20210830090648696.png)



### Re库的贪婪匹配和最小匹配

![image-20210830091203710](爬虫1.assets/image-20210830091203710.png)

![image-20210830091239946](爬虫1.assets/image-20210830091239946.png)

![image-20210830091326303](爬虫1.assets/image-20210830091326303.png)

![image-20210830091354847](爬虫1.assets/image-20210830091354847.png)

当有操作符可以匹配不同长度的时候，都可以在操作符的后面增加一个？，来获得最小匹配的结果。



## 淘宝商品比价定向爬虫





![image-20210830091756369](爬虫1.assets/image-20210830091756369.png)



书包是我们输入的关键词，q是引入关键词的变量，前面可以作为向淘宝提交关键词的链接接口

![image-20210830092013049](爬虫1.assets/image-20210830092013049.png)

s表示每一页的起始商品的编号

![image-20210830092140515](爬虫1.assets/image-20210830092140515.png)



![image-20210830092242841](爬虫1.assets/image-20210830092242841.png)



返回的页面中，每一个页面都是不同的url，下一页就会有下一个url，因此对每一个页面进行单独的访问和处理



如果某一个页面解析出现了问题，那么我们继续下一个页面的解析，而不影响程序的整个执行



需要手工判断`r.encoding`是否能获得文件的编码信息



![image-20210830095029809](爬虫1.assets/image-20210830095029809.png)

![image-20210830095322973](爬虫1.assets/image-20210830095322973.png)

淘宝商品查询信息返回的价格由`view price`字段来标识，而商品的名字由`raw title`字段来标识。因此如果我们想获得这两个信息，只需要在获得的文本中检索到其中的`view price`和`raw title`并把后续的相关内容提取出来即可。从众多的文本中提取我们想要的信息用正则表达式是非常合适的工具



eval函数能够将我们获得的字符串的最外层的双引号或单引号去掉，